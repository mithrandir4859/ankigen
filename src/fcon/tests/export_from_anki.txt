/2022 Dec 22, 01:02 0139/	How do we use FHIR currently in Kate in Cerner integrations?	We call FHIR to retrieve fhir patient id, fhir encounter id. We do that right after parsing, because it is the earliest moment when we have enough data to perform the necessary FHIR calls. We call FHIR in a separate thread and store results into mongo in order to not block further message processing (tagging, fx, etc). See this: if self.flag_manager.is_epic_env: self.fhir_ids_retriever = Singleton(EpicIdsRetriever, self.cerner_notification_service) else: self.fhir_ids_retriever = Singleton( CernerIdsRetriever, self.cerner_notification_service, hospitals_to_ignore=self.flag_manager.do_not_preretrieve_external_ids_for )Also this: @wrap_into_list def _get_transformers(self, pretagging, posttagging): yield from pretagging if self.ffm.use_fhir_ids_retriever: yield self.common_di.fhir_ids_retriever if self.ffm.post_kate_readiness_asap: yield Singleton( KateReadinessAsapPoster, self.common_di.cerner_notification_service )Also this: def _handle_mappings_in_another_thread_if_necessary(self, external_ids, hospital): external_ids_copy = ExternalIds(**dict(external_ids.to_mongo())) external_ids_copy.hospital = hospital thread = Thread(target=self.handle_mappings, args=(external_ids_copy,)) thread.start()	
/2022 Dec 22, 01:02 0502/	How are we going to trigger FHIR calls in the near future, for Epic integrations?	We will need to trigger FHIR calls based on some messages, likely ADT messages. Logistically we should be ready to perform from 1 to 200 fhir calls, where the most likely number of calls would be from 3 to 10. The data that we will receive will need to go through parsing, tagging, fx, etc.	
/2022 Dec 22, 01:02 1153/	Assuming we will make on average at least 3 data fhir calls per encounter, should we process each response individually or together?	The question may be rephrased as: should we parse, tag, fx each response separately and then merge the data together or should we merge the data before parsing? Different FHIR endpoints would return different data which will require different parsing, tagging, feature extraction, so it is only natural that processing of various responses would be set up differently and will happen individually.